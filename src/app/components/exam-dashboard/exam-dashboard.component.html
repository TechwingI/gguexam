<!-- exam-dashboard.component.html -->
<div class="min-h-screen relative glacier-bg flex flex-col">
  <div id="snowfall-container" class="fixed inset-0 pointer-events-none z-10"></div>

  <!-- Background -->
  <div class="absolute inset-0 bg-cover bg-center bg-no-repeat"
       [style.background-image]="'url(https://readdy.ai/api/search-image?query=Magical%20Christmas%20winter%20wonderland%20scene%20with%20Santa%20Claus%20riding%20his%20sleigh%20pulled%20by%20flying%20reindeer%20over%20snowy%20glacier%20mountains%2C%20carrying%20colorful%20gift%20bags%2C%20Northern%20Lights%20dancing%20in%20the%20starry%20night%20sky%2C%20snow-covered%20pine%20trees%2C%20crystalline%20ice%20formations%2C%20peaceful%20winter%20landscape%2C%20cinematic%20lighting%2C%20festive%20holiday%20atmosphere%2C%20detailed%203D%20rendering%20style&width=1920&height=1080&seq=christmas-glacier-exam&orientation=landscape)'"
       style="opacity: 0.2;"></div>

  <!-- Header -->
  <div class="glass-card p-4 sm:p-6 m-2 sm:m-4 rounded-xl relative z-10 w-full max-w-full">
    <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 lg:gap-8">
      <div class="flex-1 w-full">
        <h2 class="text-xl sm:text-2xl md:text-3xl font-bold text-white neon-text mb-2 sm:mb-4">
          ðŸŽ„ Glacier Coding Challenge Portal
        </h2>

        <div class="w-full bg-white/20 rounded-full h-2 sm:h-3">
          <div class="progress-bar h-full rounded-full transition-all duration-500"
               [style.width]="progress + '%'"></div>
        </div>

        <div class="flex justify-between text-xs sm:text-sm text-blue-200 mt-1 sm:mt-2">
          <span>Progress: {{ getAnsweredCount() }}/{{ examService.getTotalQuestions() }}</span>
          <span>Section: {{ currentSection }}</span>
        </div>
      </div>

      <!-- Timer -->
      <div class="w-full sm:w-auto">
        <div class="glass-card p-3 sm:p-4 rounded-xl timer-glow text-center">
          <div class="text-2xl sm:text-3xl font-bold text-white neon-text">{{ timer }}</div>
          <div class="text-xs sm:text-sm text-blue-200">Time Remaining</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Layout -->
  <div class="flex flex-col lg:flex-row gap-4 p-2 sm:p-4 pt-0 relative z-10 flex-1 mt-4">

    <!-- Navigator -->
    <div class="w-full lg:w-64 glass-card rounded-xl p-3 sm:p-4 slide-in overflow-auto max-h-[300px] lg:max-h-full">
      <h3 class="text-base sm:text-lg font-semibold text-white mb-3 sm:mb-4">
        Question Navigator
      </h3>

      <div class="space-y-3 text-xs sm:text-sm">

        <!-- Aptitude -->
        <div *ngIf="examService.getExamData().aptitude.length > 0">
          <div class="text-blue-200 mb-1 sm:mb-2">
            Aptitude ({{ examService.getExamData().aptitude.length }})
          </div>
          <div class="grid grid-cols-5 gap-1 sm:gap-2">
            <button *ngFor="let i of getIndexes('aptitude')"
                    (click)="loadQuestion(i)"
                    [ngClass]="getQuestionButtonClass(i)"
                    class="h-7 sm:h-8 text-xs sm:text-sm">
              {{ i + 1 }}
            </button>
          </div>
        </div>

        <!-- Verbal -->
        <div *ngIf="examService.getExamData().verbal.length > 0">
          <div class="text-blue-200 mb-1 sm:mb-2">
            Verbal ({{ examService.getExamData().verbal.length }})
          </div>
          <div class="grid grid-cols-5 gap-1 sm:gap-2">
            <button *ngFor="let i of getIndexes('verbal')"
                    (click)="loadQuestion(i)"
                    [ngClass]="getQuestionButtonClass(i)"
                    class="h-7 sm:h-8 text-xs sm:text-sm">
              {{ i + 1 }}
            </button>
          </div>
        </div>

        <!-- Technical -->
        <div *ngIf="examService.getExamData().technical.length > 0">
          <div class="text-blue-200 mb-1 sm:mb-2">
            Technical ({{ examService.getExamData().technical.length }})
          </div>
          <div class="grid grid-cols-5 gap-1 sm:gap-2">
            <button *ngFor="let i of getIndexes('technical')"
                    (click)="loadQuestion(i)"
                    [ngClass]="getQuestionButtonClass(i)"
                    class="h-7 sm:h-8 text-xs sm:text-sm">
              {{ i + 1 }}
            </button>
          </div>
        </div>

        <!-- Coding -->
        <div *ngIf="examService.getExamData().coding.length > 0">
          <div class="text-blue-200 mb-1 sm:mb-2">
            Coding ({{ examService.getExamData().coding.length }})
          </div>
          <div class="grid grid-cols-2 gap-1 sm:gap-2">
            <button *ngFor="let i of getIndexes('coding')"
                    (click)="loadQuestion(i)"
                    [ngClass]="getQuestionButtonClass(i)"
                    class="h-7 sm:h-8 text-xs sm:text-sm">
              {{ i + 1 }}
            </button>
          </div>
        </div>

      </div>

      <!-- Legend -->
      <div class="mt-4 sm:mt-6 space-y-1 sm:space-y-2 text-xs sm:text-sm">
        <div class="flex items-center text-blue-200">
          <div class="w-3 h-3 sm:w-4 sm:h-4 bg-green-500 rounded mr-2"></div>
          <span>Answered</span>
        </div>
        <div class="flex items-center text-blue-200">
          <div class="w-3 h-3 sm:w-4 sm:h-4 bg-yellow-500 rounded mr-2"></div>
          <span>Current</span>
        </div>
        <div class="flex items-center text-blue-200">
          <div class="w-3 h-3 sm:w-4 sm:h-4 bg-white/30 rounded mr-2"></div>
          <span>Not Visited</span>
        </div>
      </div>
    </div>

    <!-- Question Panel -->
    <div *ngIf="!showCodingEnv"
         class="flex-1 glass-card rounded-xl p-4 sm:p-6 question-card overflow-auto max-h-[700px]">

      <div *ngIf="getCurrentQuestion() as currentQuestion" class="fade-in">
        <div class="flex items-center justify-between mb-4 sm:mb-6">
          <h3 class="text-lg sm:text-xl font-semibold text-white">
            Question {{ currentQuestionIndex + 1 }}
          </h3>
          <span class="px-2 sm:px-3 py-1 bg-primary/20 text-primary rounded-full text-xs sm:text-sm font-medium">
            {{ currentSection }}
          </span>
        </div>

        <div class="text-base sm:text-lg text-blue-100 mb-4 sm:mb-6 leading-relaxed">
          {{ currentQuestion.question }}
        </div>

        <div class="space-y-2 sm:space-y-3">
          <label *ngFor="let option of currentQuestion.options; let i = index"
                 (click)="selectAnswer(currentQuestionIndex, i)"
                 [ngClass]="getOptionClass(currentQuestionIndex, i)"
                 class="flex items-center p-3 sm:p-4 rounded-lg cursor-pointer transition-all duration-300">
            <input type="radio"
                   name="answer-{{ currentQuestionIndex }}"
                   [value]="i"
                   [checked]="getAnswer(currentQuestionIndex) === i"
                   class="hidden">
            <div class="w-4 h-4 sm:w-5 sm:h-5 rounded-full border-2 border-white/50 mr-3 sm:mr-4 flex items-center justify-center">
              <div *ngIf="getAnswer(currentQuestionIndex) === i"
                   class="w-2 h-2 sm:w-3 sm:h-3 rounded-full bg-primary"></div>
            </div>
            <span class="text-blue-100 text-sm sm:text-base">{{ option }}</span>
          </label>
        </div>

        <div class="flex justify-between mt-6 sm:mt-8">
          <button (click)="prevQuestion()"
                  [disabled]="currentQuestionIndex === 0"
                  class="px-4 sm:px-6 py-2 sm:py-3 bg-white/20 text-white rounded-button hover:bg-white/30 transition-all duration-300 whitespace-nowrap text-xs sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed">
            <i class="ri-arrow-left-line mr-2"></i>
            Previous
          </button>

          <button (click)="nextQuestion()"
                  class="px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-primary to-secondary text-white rounded-button neon-glow hover:scale-105 transition-all duration-300 whitespace-nowrap text-xs sm:text-sm">
            Next
            <i class="ri-arrow-right-line ml-2"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Coding Panel -->
    <app-coding-environment *ngIf="showCodingEnv"
                            [questionIndex]="codingQuestionIndex"
                            (prevQuestion)="prevQuestion()"
                            (nextQuestion)="nextQuestion()"
                            class="flex-1 max-h-[700px] overflow-auto">
    </app-coding-environment>
  </div>
</div>